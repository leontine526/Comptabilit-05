{% extends 'base.html' %}

{% block content %}
<div class="container py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0">Exemples d'exercices</h1>
            <div class="d-flex gap-2">
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="categoryFilter" data-bs-toggle="dropdown" aria-expanded="false">
                        {% if current_category %}{{ current_category }}{% else %}Toutes les catégories{% endif %}
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="categoryFilter">
                        <li><a class="dropdown-item" href="{{ url_for('exercise_examples_list') }}">Toutes les catégories</a></li>
                        {% for category in categories %}
                            <li><a class="dropdown-item" href="{{ url_for('exercise_examples_list', category=category) }}">{{ category }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
                <a href="{{ url_for('exercise_example_upload') }}" class="btn btn-primary">
                    <i class="fas fa-plus-circle me-2"></i>Ajouter un exemple
                </a>
            </div>
        </div>

        {% if not current_user.is_admin %}
        <div class="alert alert-info" role="alert">
            <i class="fas fa-info-circle me-2"></i>
            Vous voyez les exemples publics et ceux que vous avez créés. Certains exercices peuvent être réservés aux enseignants et administrateurs.
        </div>
        {% endif %}

    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h5 class="mb-0">À propos de la fonctionnalité</h5>
        </div>
        <div class="card-body">
            <p>Cette fonctionnalité vous permet de télécharger des exemples d'exercices comptables résolus au format PDF. 
            Le système analysera ces exemples et pourra ensuite s'en inspirer pour résoudre de nouveaux exercices similaires.</p>

            <p>Pour des résultats optimaux :</p>
            <ul>
                <li>Veillez à ce que vos PDF contiennent du <strong>texte indexable</strong> et non des images</li>
                <li>Incluez à la fois l'énoncé et la solution dans le même document</li>
                <li>Plus vous téléchargez d'exemples variés, plus le système sera capable de résoudre différents types d'exercices</li>
            </ul>
        </div>
    </div>

    {% if examples %}
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            {% for example in examples %}
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span class="badge bg-{{ 'primary' if example.difficulty <= 2 else ('warning' if example.difficulty <= 4 else 'danger') }}">
                            {% set difficulty_labels = ['Très facile', 'Facile', 'Moyen', 'Difficile', 'Très difficile'] %}
                            {{ difficulty_labels[example.difficulty - 1] }}
                        </span>
                        <span class="badge bg-secondary">{{ example.category|title }}</span>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">{{ example.title }}</h5>
                        <p class="card-text small text-muted">
                            Ajouté le {{ example.upload_date.strftime('%d/%m/%Y à %H:%M') }}
                            {% if example.user.id == current_user.id %}
                            <span class="text-primary">(par vous)</span>
                            {% else %}
                            <span>(par {{ example.user.username }})</span>
                            {% endif %}
                        </p>
                        <p class="card-text">
                            {% if example.problem_text %}
                            {{ example.problem_text[:150] }}...
                            {% else %}
                            <em>Texte de l'énoncé non disponible</em>
                            {% endif %}
                        </p>
                    </div>
                    <div class="card-footer">
                        <a href="{{ url_for('exercise_example_view', example_id=example.id) }}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i> Voir les détails
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> Aucun exemple d'exercice n'a encore été téléchargé. 
            <a href="{{ url_for('exercise_example_upload') }}" class="alert-link">Téléchargez votre premier exemple</a> pour commencer.
        </div>
    {% endif %}
</div>
{% endblock %}